<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agemmay</title>

    <link rel="stylesheet" href="bulma.min.css">
</head>
<body>


    <div class="content">
        <h2 class="content-title">
            Code de transcription latine
        </h2>
        <p class="mx-auto">
            I) Alphabet<br>
            a) voyelles<br>
            a aman = (eau) u tamurt = (terre)<br>
            i imi = (bouche) e atef = (renter)<br>
            b) semi-voyelles<br>
            y iyuren = (les mois) w iwdan = (les gens)<br>
            c) consonnes<br>
            b atbir = (pigeon)<br>
            c (ch) acinwey = (chinois)<br>
            d aydi = (chien)<br>
            f ifassen = (les mains)<br>
            g argaz = (homme)<br>
            h hayya = (souhaiter) se prononce comme le "h" anglais ou le " ـھــ "arabe.<br>
            ḥ ḥmel = (aimer). se prononce comme le "ح "arabe.<br>
            j jaṛ = (entre)<br>
            k kker = (se lever)<br>
            l alili = (laurier rose)<br>
            m zmer = (pouvoir)<br>
            n anu = (puits)<br>
            p ppa = (père)<br>
            q qqim = (s’asseoir) se prononce comme le "" arabe.<br>
            r arra = (enfants) ; le /r/ roulé<br>
            s senn = (deux)<br>
            t tisent = (sel)<br>
            v tavenvant = (toupie, rotation rapide)<br>
            x ixef = (tête) se prononce comme le "j" espagnol ou le "خ "arabe.<br>
            z zdey = (unir)<br>
            ε aεban = (couverture) se prononce comme le "ع"arabe.<br>
            ɣ aɣyul = (âne) se prononce comme le /r/ grasseyé ou comme le "غ "arabe.<br>
            II) Signes<br>
            - Le point souscrit (exception du /ḥ/) indique que la lettre est emphatique, et donc<br>
            l’ensemble du mot, se réalise emphatique.<br>
            - La tension est rendue par le redoublement de la consonne ou de la semi-consonne : dder = (vivre).<br>
            - Les labiovélaires sont notées /ggw<br>/ ou /kkʷ<br>/.<br>
            - Le tiret est utilisé dans les contextes suivants :<br>
            1) Pour relier les démonstratifs (-u, -n) et le nom.<br>
            2) Pour relier les pronoms C.O.D et le verbe lorsqu’ils sont postposés au verbe.<br>
            3) Pour relier les éléments d’une locution figée : (u-lli) ou les mots amalgamés :<br>
            (al-d, cṛa-n, cṛa-d...)<br>
            4) Pour isoler le son y engendré par certains contextes vocaliques afin de éviter le<br>
            hiatus : inna-y-as.
        </p>
    </div>

</body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tarifiyt.com</title>

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

    <style>
        #story {
            --s: 30px; /* the size on the corner */
            --t: 7px;  /* the thickness of the border */
            --g: 20px; /* the gap between the border and image */
            --r: 5px;
            
            padding: calc(var(--g) + var(--t));
            outline: var(--t) solid #000000; /* the color here */
            outline-offset: calc(-1*var(--t));
            border-radius: var(--r);
            -webkit-mask:
                conic-gradient(at var(--s) var(--s),#0000 75%,#000 0)
                0 0/calc(100% - var(--s)) calc(100% - var(--s)),
                linear-gradient(#000 0 0) content-box;
        }
    </style>

  </head>
  <body>

    <nav class="navbar" style="margin: 4px;" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://tarifiyt.com"><img src="/images/logo.png" alt="Tarifiyt.com: Mani tt-munen Imaziɣen d iḥuriyen"></a>
        </div>
    </nav>



  <section class="section">
    <div class="container">
        <h1 class="title">Tinfusin n Figuig</h1>

        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li><a href="https://tarifiyt.com">
                    <span class="icon">
                        <i class="fas fa-home"></i>
                      </span>
                      Tarifiyt.com</a></li>
                <li><a href="#">Figuig</a></li>
                <li><a href="/figuig/tinfusin.html">Tinfusin</a></li>
                <li class="is-active"><a id="story-title2" href="#" aria-current="page"></a></li>
            </ul>
        </nav>


        <div style="background-color: rgb(249, 243, 243); border-radius: 20px;">
            <div class="text-center max-w-3xl mx-auto p-4" style="font-family: sans-serif;">
                <h2 class="title is-4 pb-4" id="story-title"></h2>
                <p class="subtitle" id="story">
                </p>
            </div>
        </div>
    </div>
  </section>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip({html:true})
        })
        String.prototype.replaceAt = function(index, replacement) {
            return this.substring(0, index) + replacement + this.substring(index + replacement.length);
        }

        function rtrim(x, characters) {
            var start = 0;
            var end = x.length - 1;
            while (characters.indexOf(x[end]) >= 0) {
                end -= 1;
            }
            return x.substr(0, end + 1);
        }

        function rpunc(x){
            q = '!?.,;"-–\': '
            for (const s in q){
                x = x.replaceAll(q[s], '')
            }
            return x
        }

        function r4(x){
            return x.replace(' 1', '').replace(' 2', '').replace(' 3', '').replace(' 4', '')
        }
        function rtag(x){
            a = ['art.', 'adv.', 'adj.', 'c.o.d.', 'c.o.i.', 'f.', 'pl.', 'conj.', 'dém.', 'étym.', 'exp.', 'interj.', 'intr.', 'inv.', 'loc.', 'm.', 'n.', 'n.m.', 'n.f.', 'num.', 'poss.', 'prép.', 'pro.', 'rq.', 'sing.', 'tps.', 'tr.', 'v.', 'voir.', 'masc.']
            for (const s in a){
                x = x.replaceAll(`<${a[s]}>`, `<span class='tag is-dark'>${a[s]}</span>`)
            }
            return x.replace('<et>', 'et')//.replace('<adj.>', "<span class='tag is-dark'>adj.</span>").replace('<n.f.>', "<span class='tag is-dark'>n.f.</span>").replace('<adv.>', "<span class='tag is-dark'>adv.</span>").replace('<voir.>', "<span class='tag is-dark'>voir.</span>").replace('<m.>', "<span class='tag is-dark'>m.</span>")
        }



        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        let tanfust = parseInt(params.tanfust);

        let story = ''
        let title = ''
        let end = '';

        let info = [];


        fetch('/data/stories.json')
            .then((response) => response.json())
            .then((json) => star(json));

        function star(json){
            for (m_s in json){
                end = ''
                // story = json[tanfust-1]
                story = json[m_s]
                    if (story == undefined){
                        window.location.replace("/404.html");
                    }
                    story = story['story']
                    title = story.split('\n', 1)[0]
                    story = story.substring(title.length).replace('\n', '')
                    $("#story-title").html(title)
                    $("#story-title2").text(title.split('<', 1)[0])
                    $("#story").html(story.replace(/\n/g, '<br>'))
                    if (story.includes('\nAnday.\n')){
                        end = (story.substring(story.indexOf('\nAnday.\n') + 9, story.length))
                        story = story.replace(end, '')
                    }
                    story = story.split(/([\s-"\.:;,]+)/)
                    
                    fetch('/data/entries.json')
                    .then((response) => response.json())
                    .then((json) => proc(json));
                }
            }


            

        function proc(json){ // (ϕ-/y-) (a-/u-) (ϕ-/w-) (ϕ-/u-)
            let s = '' // (ta-/t-) (ϕ-/ϕ-) (i-/i-) (i-/ϕ-) (ta-/te) (t-/te) (ti-/t-) (ti-/te-) (a-/u) (t-/t-)
            let tooltip = ''

            for (const w in story){
                let found = false;
                
                for (const d in json){
                    let hi = story[w].toLowerCase()
                    if (hi[0] == 'u' && r4(json[d]['def']).includes('(a-/u-)')){
                        hi = hi.replaceAt(0, 'a')
                    } else {
                        if (hi[0] == 'y' && r4(json[d]['def']).includes('(ϕ-/y-)')){
                            hi = hi.substring(1, hi.length)
                        } else {
                            if (hi[0] == 'w' && r4(json[d]['def']).includes('(ϕ-/w-)')){
                                hi = hi.substring(1, hi.length)
                            } else {
                                if (hi[0] == 'u' && r4(json[d]['def']).includes('(ϕ-/u-)')){
                                    hi = hi.substring(1, hi.length)
                                }
                            }
                        } 
                    }
                    
                    if (r4(json[d]['latin']) === story[w].toLowerCase() || r4(json[d]['latin']) === hi){
                        tooltip += rtag(json[d]['f_def']) + "\n- Ou -\n"
                        found = true;
                    }
                } // "<span class='tag is-dark'>n.f.</span>"
                if (!found){
                    for (const d in json){
                        let check = rpunc(story[w].toLowerCase())
                        if (check != ''){
                            if (r4(json[d]['def']).split(/([\s-"\.:;,]+)/).includes(check)){
                                tooltip += rtag(json[d]['f_def']) + "\n- Ou -\n"
                                found = true;
                            }
                        }
                    }
                    if (!found){
                        // console.log(story[w])
                        s += story[w]
                    } else {
                        s += `<button type="button" style="background: none; color: red; border: none; font-weight: 700;" data-toggle="tooltip" data-html="true" title="${rtrim(tooltip, '- Ou -\n')}">${story[w]}</button>`
                        tooltip = ''

                    }
                } else {
                    s += `<button type="button" style="background: none; border: none; font-weight: 700;" data-toggle="tooltip" data-html="true" title="${rtrim(tooltip, '- Ou -\n')}">${story[w]}</button>`
                    tooltip = ''
                }
                // s += ' '
            }
            let chars = ';.,:!?-–'
            // s = s.replaceAll(' ', '')
            for (const c in chars){
                s = s.replaceAll(` ${chars[c]}`, chars[c])
            } s = s.replaceAll(' - ', '-')
            $("#story").html((s+end).replace(/\n/g, '<br>'))
            $(function () {
                $('[data-toggle="tooltip"]').tooltip({html:true})
            })

            info.push({
                'title':title,
                'story': (s+end).replace(/\n/g, '<br>')
            })
            console.log(m_s)
        }

        console.log(info)
        
    </script>

  </body>  
</html>